<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Van Booking Portal | Heidi Van Horny</title>
    <link
      rel="icon"
      type="image/svg+xml"
      href="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 128 128'><rect width='128' height='128' fill='%23000000'/><text x='64' y='78' text-anchor='middle' font-family='Arial, sans-serif' font-size='56' fill='%23ffffff' font-weight='700'>HVH</text></svg>"
    />
    <style>
      :root {
        --bg: #fff5fb;
        --bg-2: #ffe3f2;
        --ink: #12040a;
        --pink: #ff2d93;
        --hot: #ff006e;
        --neon: #ff48a5;
        --line: rgba(255, 0, 110, 0.25);
        --shadow: rgba(255, 0, 110, 0.22);
        --mono: "Avenir Next", "Trebuchet MS", "Segoe UI", "Helvetica Neue", Arial, sans-serif;
        --bubble: "Baloo 2", "Cooper Black", "Bookman Old Style", "Georgia", serif;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: var(--mono);
        color: var(--ink);
        background: radial-gradient(circle at 20% 10%, #ffe1f0 0%, #fff5fb 45%, #fff 100%);
        min-height: 100vh;
        position: relative;
        overflow-x: hidden;
      }

      body::before,
      body::after {
        content: "";
        position: fixed;
        width: 520px;
        height: 520px;
        border-radius: 50%;
        filter: blur(0px);
        opacity: 0.45;
        z-index: 0;
      }

      body::before {
        top: -240px;
        right: -120px;
        background: radial-gradient(circle, rgba(255, 0, 110, 0.3), transparent 70%);
      }

      body::after {
        bottom: -260px;
        left: -140px;
        background: radial-gradient(circle, rgba(255, 72, 165, 0.35), transparent 70%);
      }

      .age-language {
        position: fixed;
        top: clamp(14px, 4vw, 24px);
        right: clamp(14px, 4vw, 24px);
        left: auto;
        display: inline-flex;
        gap: 8px;
        padding: 0;
        border: none;
        background: transparent;
        box-shadow: none;
        z-index: 130;
      }

      .age-language .language-button {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 2px 4px;
        border: none;
        background: transparent;
        color: #fff;
        cursor: pointer;
        letter-spacing: 1px;
        text-transform: uppercase;
        font-size: 12px;
        transition: transform 0.12s ease, opacity 0.12s ease;
      }

      .age-language .language-button[aria-pressed="true"] {
        opacity: 1;
        text-decoration: underline;
        text-underline-offset: 3px;
      }

      .age-language .language-button:focus-visible,
      .age-language .language-button:hover {
        transform: translateY(-1px);
        outline: none;
        opacity: 0.9;
      }

      .age-language .language-flag {
        display: inline-flex;
        width: 20px;
        height: 14px;
      }

      .age-language .language-flag svg {
        width: 100%;
        height: auto;
        display: block;
      }

      header {
        position: relative;
        z-index: 1;
        padding: 64px 24px 32px;
        max-width: 980px;
        margin: 0 auto;
        animation: floatIn 0.9s ease-out;
      }

      .back-row {
        margin-bottom: 16px;
      }

      .back-link {
        display: inline-flex;
        align-items: center;
        padding: 6px 12px;
        border-radius: 999px;
        border: 1px solid var(--line);
        background: #fff;
        color: var(--hot);
        font-size: 12px;
        letter-spacing: 0.18em;
        text-transform: uppercase;
        text-decoration: none;
      }

      .back-link:hover,
      .back-link:focus-visible {
        outline: none;
        box-shadow: 0 12px 22px rgba(255, 0, 110, 0.18);
      }

      .tag {
        display: inline-flex;
        align-items: center;
        padding: 6px 14px;
        border-radius: 999px;
        border: 1px solid var(--line);
        background: #fff;
        color: var(--hot);
        font-size: 12px;
        letter-spacing: 0.2em;
        text-transform: uppercase;
        margin-bottom: 16px;
      }

      h1 {
        font-family: var(--bubble);
        font-size: clamp(2.6rem, 5vw, 4.4rem);
        margin: 0 0 12px;
        color: var(--hot);
        text-shadow: 0 0 12px rgba(255, 0, 110, 0.4);
      }

      .subtitle {
        font-size: clamp(1rem, 1.3vw, 1.2rem);
        max-width: 620px;
        margin: 0 0 22px;
        color: #3b0f23;
      }

      main {
        position: relative;
        z-index: 1;
        max-width: 980px;
        margin: 0 auto;
        padding: 0 24px 90px;
      }

      form {
        display: grid;
        gap: 24px;
      }

      .wizard-top {
        background: #fff;
        border: 1px solid var(--line);
        border-radius: 20px;
        padding: 16px 18px;
        box-shadow: 0 16px 30px var(--shadow);
      }

      .wizard-count {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 6px 12px;
        border-radius: 999px;
        border: 1px solid rgba(255, 0, 110, 0.28);
        background: rgba(255, 0, 110, 0.08);
        font-size: 0.86rem;
        letter-spacing: 0.04em;
        text-transform: none;
        color: #8e1e52;
        font-weight: 700;
      }

      .wizard-title {
        margin: 8px 0 10px;
        color: #4a0d26;
        font-size: 0.95rem;
      }

      .wizard-status {
        margin: 8px 0 0;
        color: #7a1c45;
        font-size: 0.86rem;
      }

      .wizard-bar {
        height: 8px;
        border-radius: 999px;
        background: rgba(255, 0, 110, 0.1);
        overflow: hidden;
      }

      .wizard-fill {
        display: block;
        height: 100%;
        width: 0%;
        background: linear-gradient(135deg, #ff2d93, #ff006e);
        transition: width 0.2s ease;
      }

      .panel {
        background: #fff;
        border: 1px solid var(--line);
        border-radius: 24px;
        padding: 24px;
        box-shadow: 0 20px 40px var(--shadow);
        animation: fadeUp 0.8s ease-out;
      }

      .panel h2 {
        margin: 0 0 16px;
        font-size: 1.1rem;
        letter-spacing: 0.04em;
        text-transform: none;
        color: var(--hot);
      }

      .grid {
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 18px;
      }

      .span-2 {
        grid-column: 1 / -1;
      }

      label {
        display: block;
        font-size: 0.9rem;
        text-transform: none;
        letter-spacing: 0.01em;
        margin-bottom: 6px;
        color: #6b173f;
        font-weight: 600;
      }

      input,
      select,
      textarea {
        width: 100%;
        padding: 12px 14px;
        border-radius: 14px;
        border: 1px solid rgba(255, 0, 110, 0.3);
        font-family: var(--mono);
        font-size: 0.95rem;
        background: #fff9fc;
        color: var(--ink);
        transition: border 0.2s ease, box-shadow 0.2s ease;
      }

      select,
      option {
        color: #2a0d1a !important;
        background: #fff !important;
      }

      input[type="date"],
      input[type="time"],
      input[type="month"],
      input[type="datetime-local"] {
        color: #2a0d1a !important;
        -webkit-text-fill-color: #2a0d1a;
        background: #fff !important;
        color-scheme: light;
      }

      input[type="date"]::-webkit-datetime-edit,
      input[type="time"]::-webkit-datetime-edit,
      input[type="month"]::-webkit-datetime-edit,
      input[type="datetime-local"]::-webkit-datetime-edit {
        color: #2a0d1a;
      }

      input:focus,
      select:focus,
      textarea:focus {
        outline: none;
        border-color: var(--hot);
        box-shadow: 0 0 0 3px rgba(255, 0, 110, 0.18);
      }

      textarea {
        min-height: 120px;
        resize: vertical;
      }

      .radio-row {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
      }

      .followup-block {
        margin-top: 10px;
        padding: 10px 12px;
        border-radius: 12px;
        border: 1px solid rgba(255, 0, 110, 0.2);
        background: rgba(255, 0, 110, 0.04);
      }

      .followup-title {
        margin: 0 0 8px;
        font-size: 0.84rem;
        color: #5a1431;
      }

      .radio-card {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px 14px;
        border-radius: 14px;
        border: 1px solid rgba(255, 0, 110, 0.3);
        background: #fff9fc;
        cursor: pointer;
      }

      .radio-card input {
        margin: 0;
      }

      .radio-card span {
        min-width: 0;
        overflow-wrap: anywhere;
      }

      #bookingTypeField .radio-row {
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 12px;
      }

      #bookingTypeField .radio-card {
        position: relative;
        padding: 0;
        border: none;
        background: transparent;
      }

      #bookingTypeField .radio-card input {
        position: absolute;
        opacity: 0;
        width: 1px;
        height: 1px;
      }

      #bookingTypeField .radio-card span {
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 60px;
        width: 100%;
        padding: 12px 16px;
        border-radius: 16px;
        border: 1px solid rgba(255, 0, 110, 0.35);
        background: #fff8fc;
        color: #4a1630;
        font-weight: 700;
        letter-spacing: 0.02em;
        white-space: nowrap;
        transition: border-color 0.2s ease, box-shadow 0.2s ease, background 0.2s ease, color 0.2s ease,
          transform 0.2s ease;
      }

      #bookingTypeField .radio-card input:checked + span {
        border-color: var(--hot);
        background: linear-gradient(145deg, #ff1690, #ff007a);
        color: #ffffff;
        box-shadow: 0 10px 26px rgba(255, 0, 120, 0.28);
        transform: translateY(-1px);
      }

      #bookingTypeField .radio-card input:focus-visible + span {
        box-shadow: 0 0 0 3px rgba(255, 0, 110, 0.26);
      }

      #bookingTypeField .hint {
        margin-top: 10px;
      }

      .checkbox-list {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 10px;
        margin-top: 6px;
      }

      .checkbox-card {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px 12px;
        border-radius: 12px;
        border: 1px solid rgba(255, 0, 110, 0.3);
        background: #fff9fc;
        cursor: pointer;
      }

      .checkbox-card input {
        margin: 0;
        width: 16px;
        height: 16px;
        accent-color: var(--hot);
      }

      .hint {
        font-size: 0.85rem;
        color: #7a1c45;
        margin-top: 8px;
      }

      .time-preview {
        margin-top: 12px;
        padding: 12px 14px;
        border-radius: 12px;
        background: rgba(255, 0, 110, 0.08);
        font-size: 0.9rem;
      }

      .day-calendar {
        position: relative;
        margin-top: 14px;
        padding: 18px;
        border-radius: 18px;
        border: 1px solid rgba(255, 0, 110, 0.2);
        background: rgba(255, 255, 255, 0.9);
        display: flex;
        flex-direction: column;
        gap: 8px;
        overflow: hidden;
      }

      .day-calendar::before {
        content: attr(data-city);
        position: absolute;
        inset: 0;
        display: grid;
        place-items: center;
        font-size: clamp(2rem, 8vw, 5rem);
        color: rgba(255, 45, 147, 0.08);
        letter-spacing: 0.3em;
        text-transform: uppercase;
        pointer-events: none;
        z-index: 0;
      }

      .day-calendar .slot {
        position: relative;
        z-index: 1;
        padding: 10px 12px;
        border-radius: 12px;
        border: 1px solid rgba(255, 0, 110, 0.2);
        background: #fff7fb;
        color: #4a0d26;
        font-size: 0.9rem;
        letter-spacing: 0.05em;
        text-transform: uppercase;
        text-align: left;
        cursor: pointer;
      }

      .day-calendar .slot.available:hover,
      .day-calendar .slot.available:focus-visible {
        outline: none;
        border-color: rgba(255, 0, 110, 0.6);
        box-shadow: 0 10px 18px rgba(255, 0, 110, 0.18);
        transform: translateY(-1px);
      }

      .day-calendar .slot.blocked {
        background: rgba(255, 0, 110, 0.12);
        color: rgba(74, 13, 38, 0.55);
        cursor: not-allowed;
      }

      .day-calendar .slot.selected {
        border-color: rgba(255, 0, 110, 0.8);
        background: rgba(255, 0, 110, 0.18);
        font-weight: 700;
      }

      .day-empty {
        position: relative;
        z-index: 1;
        margin: 0;
        padding: 12px;
        border-radius: 12px;
        border: 1px dashed rgba(255, 0, 110, 0.28);
        background: rgba(255, 0, 110, 0.06);
        color: #6b173f;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        font-size: 0.82rem;
      }

      .availability-summary {
        margin-top: 12px;
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        font-size: 0.9rem;
        color: #4a0d26;
      }

      .availability-summary span {
        padding: 6px 12px;
        border-radius: 999px;
        background: rgba(255, 0, 110, 0.08);
        border: 1px solid rgba(255, 0, 110, 0.2);
      }

      .deposit-box {
        border: 1px dashed rgba(255, 0, 110, 0.4);
        border-radius: 18px;
        padding: 16px;
        background: rgba(255, 0, 110, 0.06);
      }

      .deposit-box strong {
        font-size: 1.4rem;
        color: var(--hot);
      }

      .deposit-row {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        gap: 16px;
        margin: 10px 0;
      }

      .deposit-total {
        display: flex;
        align-items: center;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 6px;
        font-size: 0.95rem;
        color: #3b0f23;
      }

      .deposit-total span {
        font-weight: 700;
        color: var(--hot);
      }

      .deposit-currency {
        display: grid;
        gap: 6px;
        min-width: 160px;
      }

      .deposit-currency label {
        margin: 0;
      }

      #depositRateNote:empty {
        display: none;
      }

      #totalRateNote:empty {
        display: none;
      }

      .consent {
        display: flex;
        align-items: flex-start;
        gap: 10px;
        margin-top: 18px;
        font-size: 0.9rem;
        color: #3b0f23;
      }

      .cta {
        margin-top: 18px;
        padding: 14px 22px;
        border-radius: 999px;
        border: none;
        background: linear-gradient(135deg, #ff2d93, #ff006e);
        color: #fff;
        font-size: 1rem;
        letter-spacing: 0.1em;
        text-transform: uppercase;
        cursor: pointer;
        box-shadow: 0 16px 30px rgba(255, 0, 110, 0.3);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }

      .cta:hover {
        transform: translateY(-2px);
        box-shadow: 0 20px 40px rgba(255, 0, 110, 0.4);
      }

      .whatsapp-cta {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        margin-top: 12px;
        padding: 12px 18px;
        border-radius: 999px;
        border: 1px solid var(--hot);
        color: var(--hot);
        text-decoration: none;
        font-size: 0.95rem;
      }

      .popup-overlay {
        position: fixed;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(10, 4, 8, 0.45);
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.2s ease;
        z-index: 9999;
      }

      .popup-overlay.show {
        opacity: 1;
        pointer-events: auto;
      }

      .popup-card {
        width: min(420px, 92vw);
        background: #fff;
        border: 1px solid var(--line);
        border-radius: 18px;
        padding: 20px 22px;
        box-shadow: 0 18px 36px rgba(255, 0, 110, 0.22);
        text-align: center;
      }

      .popup-card h3 {
        margin: 0 0 8px;
        font-family: var(--bubble);
        color: var(--hot);
      }

      .popup-card p {
        margin: 0 0 16px;
        color: #3b0f23;
      }

      .popup-link {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 14px;
        padding: 10px 16px;
        border-radius: 999px;
        border: 1px solid var(--hot);
        color: var(--hot);
        text-decoration: none;
        font-size: 0.9rem;
        letter-spacing: 0.08em;
        text-transform: uppercase;
      }

      .popup-link.hidden {
        display: none;
      }

      .alert-popup-overlay {
        position: fixed;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(10, 4, 8, 0.55);
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.18s ease;
        z-index: 10000;
      }

      .alert-popup-overlay.show {
        opacity: 1;
        pointer-events: auto;
      }

      .alert-popup-card {
        width: min(460px, 92vw);
        background: #fff;
        border: 2px solid rgba(255, 0, 110, 0.45);
        border-radius: 18px;
        padding: 18px 20px;
        box-shadow: 0 18px 36px rgba(255, 0, 110, 0.24);
        text-align: center;
      }

      .alert-popup-card.shake {
        animation: popupShake 0.34s ease-in-out;
      }

      .alert-popup-card h3 {
        margin: 0 0 8px;
        font-size: 1.05rem;
        letter-spacing: 0.12em;
        text-transform: uppercase;
        color: var(--hot);
      }

      .alert-popup-card p {
        margin: 0 0 14px;
        color: #3b0f23;
        line-height: 1.5;
      }

      .whatsapp-cta[hidden] {
        display: none;
      }

      .status {
        margin-top: 12px;
        font-size: 0.9rem;
        color: #7a1c45;
      }

      .wizard-nav {
        position: sticky;
        bottom: 10px;
        z-index: 5;
        display: flex;
        gap: 10px;
        justify-content: space-between;
        padding: 10px;
        border: 1px solid var(--line);
        border-radius: 16px;
        background: rgba(255, 255, 255, 0.95);
        box-shadow: 0 12px 22px rgba(255, 0, 110, 0.16);
        backdrop-filter: blur(4px);
      }

      .wizard-nav .cta {
        margin-top: 0;
        flex: 1;
      }

      .cta.secondary {
        background: #fff;
        color: var(--hot);
        border: 1px solid rgba(255, 0, 110, 0.32);
        box-shadow: none;
      }

      .cta.secondary:hover {
        box-shadow: 0 10px 18px rgba(255, 0, 110, 0.2);
      }

      .version-stamp {
        margin: 24px auto 40px;
        max-width: 980px;
        padding: 0 24px;
        font-size: 0.75rem;
        letter-spacing: 0.2em;
        text-transform: uppercase;
        color: rgba(58, 15, 35, 0.65);
        text-align: center;
      }

      .muted {
        color: #7a1c45;
        font-size: 0.85rem;
      }

      .hidden {
        display: none;
      }

      .wizard-hidden {
        display: none !important;
      }

      @keyframes floatIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes fadeUp {
        from {
          opacity: 0;
          transform: translateY(12px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes popupShake {
        0% {
          transform: translateX(0);
        }
        20% {
          transform: translateX(-8px);
        }
        40% {
          transform: translateX(7px);
        }
        60% {
          transform: translateX(-6px);
        }
        80% {
          transform: translateX(5px);
        }
        100% {
          transform: translateX(0);
        }
      }

      @media (max-width: 900px) {
        header {
          padding-top: 48px;
        }

        .grid {
          grid-template-columns: 1fr;
        }

        .panel {
          padding: 20px;
        }
      }

      @media (max-width: 640px) {
        body {
          -webkit-text-size-adjust: 100%;
        }

        header {
          padding: 52px 14px 22px;
        }

        main {
          padding: 0 14px 72px;
        }

        .panel {
          padding: 16px;
          border-radius: 18px;
        }

        .age-language {
          top: 10px;
          right: 10px;
          gap: 6px;
        }

        .age-language .language-button {
          font-size: 11px;
          gap: 4px;
          padding: 1px 2px;
        }

        .wizard-nav {
          bottom: 6px;
          gap: 8px;
          padding: 8px;
        }

        .wizard-nav .cta {
          min-width: 0;
          font-size: 0.85rem;
          padding: 12px 14px;
        }

        .checkbox-list {
          grid-template-columns: 1fr;
        }

        .radio-row {
          flex-direction: column;
          align-items: stretch;
        }

        .radio-card {
          width: 100%;
        }

        #bookingTypeField .radio-row {
          grid-template-columns: repeat(2, minmax(0, 1fr));
          gap: 10px;
        }

        #bookingTypeField .radio-card span {
          min-height: 56px;
          padding: 10px 8px;
          font-size: 0.95rem;
        }

        .deposit-currency {
          min-width: 0;
          width: 100%;
        }

        #panelPayment .deposit-total {
          display: grid;
          grid-template-columns: 1fr;
          gap: 4px;
        }

        #panelPayment .consent {
          display: grid;
          grid-template-columns: 20px 1fr;
          gap: 10px;
          align-items: start;
        }

        #panelPayment .consent input {
          margin-top: 3px;
        }

        .day-calendar {
          padding: 12px;
        }

        .day-calendar::before {
          letter-spacing: 0.16em;
          font-size: clamp(1.5rem, 12vw, 3rem);
        }
      }

      @supports (-webkit-touch-callout: none) {
        input,
        select,
        textarea {
          font-size: 16px;
        }
      }
    </style>
  </head>
  <body>
    <div class="age-language" role="group" aria-label="language selector">
      <button type="button" class="language-button" data-language-choice="en" aria-pressed="false">
        <span class="language-flag" aria-hidden="true">
          <svg viewBox="0 0 24 16" role="presentation" focusable="false">
            <rect width="24" height="16" fill="#012169"></rect>
            <path
              d="M0 0L9.5 6.5V0H14.5V6.5L24 0V3L15.5 8H24V8.5H15.5L24 13V16L14.5 9.5V16H9.5V9.5L0 16V13L8.5 8.5H0V8H8.5L0 3Z"
              fill="#fff"
            ></path>
            <path
              d="M0 0L10 6.5V0H14V6.5L24 0V2.5L13.5 8.5H24V9.5H13.5L24 15.5V16L14 9.5V16H10V9.5L0 16V13.5L10.5 9.5H0V8.5H10.5L0 2.5Z"
              fill="#c8102e"
              opacity="0.8"
            ></path>
            <path d="M9.5 0H14.5V6H24V10H14.5V16H9.5V10H0V6H9.5Z" fill="#fff"></path>
            <path d="M10.5 0H13.5V6H24V10H13.5V16H10.5V10H0V6H10.5Z" fill="#c8102e"></path>
          </svg>
        </span>
        <span class="language-code">EN</span>
      </button>
      <button type="button" class="language-button" data-language-choice="fr" aria-pressed="false">
        <span class="language-flag" aria-hidden="true">
          <svg viewBox="0 0 24 16" role="presentation" focusable="false">
            <rect width="24" height="16" fill="#fff"></rect>
            <rect width="8" height="16" fill="#002395"></rect>
            <rect width="8" height="16" x="16" fill="#ED2939"></rect>
          </svg>
        </span>
        <span class="language-code">FR</span>
      </button>
    </div>
    <header>
      <div class="back-row">
        <a class="back-link" id="backInsideLink" href="/inside.html">Back to inside</a>
      </div>
      <div class="tag">Heidi Van Horny</div>
      <h1 id="bookingTitle">Van Booking Portal</h1>
      <p class="subtitle" id="bookingSubtitle">
        Simple, private scheduling. Send your request and I email the payment details. Your booking is confirmed after
        payment is processed.
      </p>
    </header>

    <main>
      <form id="bookingForm" novalidate>
        <div class="wizard-top" id="wizardTop">
          <div class="wizard-count" id="wizardCount">Step 1 of 1</div>
          <p class="wizard-title" id="wizardTitle">Booking step</p>
          <p class="wizard-status" id="wizardStatus" aria-live="assertive"></p>
          <div class="wizard-bar"><span class="wizard-fill" id="wizardFill"></span></div>
        </div>

        <section class="panel" id="panelRequest">
          <h2 id="panelRequestTitle">Booking request</h2>
          <div class="grid">
            <div class="field">
              <label for="name">Name</label>
              <input id="name" name="name" type="text" autocomplete="name" required />
            </div>
            <div class="field">
              <label for="phone">Phone number</label>
              <input
                id="phone"
                name="phone"
                type="tel"
                inputmode="tel"
                autocomplete="tel"
                placeholder="+ (country code) 555 1234"
                pattern="\\+?[0-9\\s()\\-]{6,}"
                required
              />
              <div class="followup-block">
                <p class="followup-title" id="followupPhoneTitle">
                  Would you like me to contact you about my next trip to this city by phone?
                </p>
                <div class="radio-row">
                  <label class="radio-card">
                    <input type="radio" name="contact_followup_phone" value="yes" />
                    <span>Yes</span>
                  </label>
                  <label class="radio-card">
                    <input type="radio" name="contact_followup_phone" value="no" checked />
                    <span>No</span>
                  </label>
                </div>
                <label for="followup_phone_other_cities" id="followupPhoneCitiesLabel">Other cities?</label>
                <input
                  id="followup_phone_other_cities"
                  name="followup_phone_other_cities"
                  type="text"
                  placeholder="Optional: Toronto, Vancouver, Paris"
                />
              </div>
            </div>
            <div class="field">
              <label for="email">Email</label>
              <input id="email" name="email" type="email" autocomplete="email" required />
              <div class="followup-block">
                <p class="followup-title" id="followupEmailTitle">
                  Would you like me to contact you about my next trip to this city by email?
                </p>
                <div class="radio-row">
                  <label class="radio-card">
                    <input type="radio" name="contact_followup_email" value="yes" />
                    <span>Yes</span>
                  </label>
                  <label class="radio-card">
                    <input type="radio" name="contact_followup_email" value="no" checked />
                    <span>No</span>
                  </label>
                </div>
                <label for="followup_email_other_cities" id="followupEmailCitiesLabel">Other cities?</label>
                <input
                  id="followup_email_other_cities"
                  name="followup_email_other_cities"
                  type="text"
                  placeholder="Optional: Montreal, London, Berlin"
                />
              </div>
            </div>
            <div class="field span-2" id="notesField">
              <label for="notes">Requests, info, tell me about you if you wish :)</label>
              <textarea
                id="notes"
                name="notes"
                autocomplete="off"
                placeholder="Optional. Share requests or any helpful info."
              ></textarea>
              <p class="hint">Optional. Keep it respectful.</p>
            </div>
            <div class="field">
              <label for="preferred_date">Date of booking</label>
              <input id="preferred_date" name="preferred_date" type="date" required />
              <p class="hint" id="touringDayNote">
                On that day, Heidi will be in: <strong id="touringDayCity">Select a date</strong>
              </p>
            </div>
            <div class="field">
              <label for="city">City of booking</label>
              <select id="city" name="city" autocomplete="address-level2" required>
                <option value="" disabled selected>chose option</option>
                <option value="Montreal">Montreal</option>
                <option value="Toronto">Toronto</option>
                <option value="Vancouver">Vancouver</option>
                <option value="Paris">Paris</option>
                <option value="London (UK)">London (UK)</option>
                <option value="Berlin">Berlin</option>
                <option value="Fly me to you">Fly me to you</option>
              </select>
              <p class="hint hidden" id="cityMismatchWarning" aria-live="polite">
                Your selected city does not match the touring city for that date. Choose the touring city or Fly me to
                you.
              </p>
            </div>
            <div class="field">
              <label for="currency">Currency</label>
              <select id="currency" name="currency" required>
                <option value="" disabled selected>chose option</option>
                <option value="CAD">CAD</option>
                <option value="USD">USD</option>
                <option value="EUR">EUR</option>
                <option value="GBP">GBP</option>
                <option value="USDC">USDC</option>
                <option value="BTC">BTC</option>
                <option value="LTC">LTC</option>
              </select>
            </div>
            <div class="field">
              <label for="duration">Duration</label>
              <select id="duration" name="duration" required></select>
              <p class="hint" id="durationHint">Rates update with currency. Crypto shown in CAD.</p>
              <a
                id="whatsappDiscuss"
                class="whatsapp-cta"
                href="https://wa.me/15146076253"
                target="_blank"
                rel="noopener"
                aria-label="Discuss 24+ hour bookings on WhatsApp"
                hidden
                >Discuss it with me on WhatsApp</a
              >
            </div>
            <div class="field">
              <label for="experience">Service</label>
              <select id="experience" name="experience" required>
                <option value="" disabled>chose option</option>
                <option value="gfe" selected>GFE</option>
                <option value="pse">PSE</option>
              </select>
            </div>
            <div class="field span-2" id="bookingTypeField">
              <label>Location</label>
              <div class="radio-row">
                <label class="radio-card">
                  <input type="radio" name="booking_type" value="incall" checked />
                  <span>Incall</span>
                </label>
                <label class="radio-card">
                  <input type="radio" name="booking_type" value="outcall" />
                  <span>Outcall</span>
                </label>
              </div>
              <p class="hint">Outcall requires an address so I can confirm travel time.</p>
            </div>
            <div class="field span-2 hidden" id="outcallAddressField">
              <label for="outcall_address">Outcall address</label>
              <input id="outcall_address" name="outcall_address" type="text" autocomplete="street-address" />
            </div>
          </div>
        </section>

        <section class="panel" id="panelAvailability">
          <h2 id="panelAvailabilityTitle">Daily availability</h2>
          <p class="hint" id="availabilityNote">
            Pick a date and duration to see available start times in order.
          </p>
          <p class="hint" id="timezoneHintLine">
            Times shown in this city timezone: <strong id="tourTz">America/Toronto</strong>
          </p>
          <div class="day-calendar" id="dayCalendar" data-city=""></div>
          <div class="availability-summary" id="availabilitySummary"></div>
          <div class="field" id="timeField">
            <label for="preferred_time">Selected time</label>
            <input id="preferred_time" name="preferred_time" type="text" readonly required />
          </div>
        </section>

        <section class="panel" id="panelPayment">
          <h2 id="panelPaymentTitle">Payment confirmation</h2>
          <div class="deposit-box" id="depositBox">
            <div class="deposit-total">Base rate: <span id="baseRateDisplay">Select duration</span></div>
            <div class="deposit-total hidden" id="pseAddonRow">PSE add-on: <span id="pseAddonDisplay">--</span></div>
            <div class="deposit-total">Total: <span id="totalRateDisplay">Select duration</span></div>
            <div class="deposit-total">20% deposit: <strong id="depositRateDisplay">--</strong></div>
            <p class="hint" id="totalRateNote"></p>
            <p class="hint" id="depositRateNote">Deposit is 20% of total.</p>
          </div>
          <div class="grid" id="paymentGrid">
            <div class="field" id="paymentMethodField">
              <label for="payment_method">Payment method</label>
              <select id="payment_method" name="payment_method" required>
                <option value="" disabled selected>chose option</option>
                <option value="paypal">PayPal</option>
                <option value="wise">Wise</option>
                <option value="interac">e-Transfer (Canada only)</option>
                <option value="usdc">USDC</option>
                <option value="btc">BTC</option>
                <option value="ltc">LTC</option>
              </select>
            </div>
          </div>
          <label class="consent" for="deposit_confirm" id="depositConsentRow">
            <input id="deposit_confirm" name="deposit_confirm" type="checkbox" required />
            <span id="depositConsentText">I confirm the 20% deposit and payment method are correct.</span>
          </label>
          <p class="hint" id="paymentCryptoHint">Crypto amounts are shown as CAD reference.</p>
        </section>

        <section class="panel" id="panelSubmit">
          <button class="cta" type="submit" id="submitBtn">Request booking</button>
          <div class="status" id="formStatus"></div>
        </section>

        <div class="wizard-nav" id="wizardNav">
          <button class="cta secondary" type="button" id="wizardBack">Back</button>
          <button class="cta" type="button" id="wizardNext">Next</button>
        </div>
      </form>
    </main>
    <footer class="version-stamp">Version: 2026-02-15</footer>

    <div id="successPopup" class="popup-overlay" aria-hidden="true">
      <div class="popup-card" role="dialog" aria-modal="true" aria-labelledby="successTitle">
        <h3 id="successTitle">Request received</h3>
        <p id="successMessage"></p>
        <p class="muted" id="successEmail"></p>
        <a id="successLink" class="popup-link hidden" href="#" target="_self" rel="noopener">Pay now</a>
        <button class="cta" type="button" id="successClose">Got it</button>
      </div>
    </div>

    <div id="alertPopup" class="alert-popup-overlay" aria-hidden="true">
      <div class="alert-popup-card" role="dialog" aria-modal="true" aria-labelledby="alertPopupTitle">
        <h3 id="alertPopupTitle">Attention</h3>
        <p id="alertPopupMessage"></p>
        <button class="cta" type="button" id="alertPopupClose">OK</button>
      </div>
    </div>

    <script>
      const form = document.getElementById("bookingForm");
      const durationSelect = document.getElementById("duration");
      const experienceSelect = document.getElementById("experience");
      const currencySelect = document.getElementById("currency");
      const citySelect = document.getElementById("city");
      const cityMismatchWarning = document.getElementById("cityMismatchWarning");
      const preferredDate = document.getElementById("preferred_date");
      const preferredTime = document.getElementById("preferred_time");
      const nameInput = document.getElementById("name");
      const phoneInput = document.getElementById("phone");
      const notesInput = document.getElementById("notes");
      const whatsappDiscuss = document.getElementById("whatsappDiscuss");
      const durationHint = document.getElementById("durationHint");
      const touringDayCityEl = document.getElementById("touringDayCity");
      const availabilityNote = document.getElementById("availabilityNote");
      const availabilitySummary = document.getElementById("availabilitySummary");
      const dayCalendar = document.getElementById("dayCalendar");
      const panelRequest = document.getElementById("panelRequest");
      const panelAvailability = document.getElementById("panelAvailability");
      const panelPayment = document.getElementById("panelPayment");
      const panelSubmit = document.getElementById("panelSubmit");
      const paymentMethodField = document.getElementById("paymentMethodField");
      const depositConsentRow = document.getElementById("depositConsentRow");
      const paymentCryptoHint = document.getElementById("paymentCryptoHint");
      const paymentGrid = document.getElementById("paymentGrid");
      const outcallField = document.getElementById("outcallAddressField");
      const bookingTypeField = document.getElementById("bookingTypeField");
      const outcallInput = document.getElementById("outcall_address");
      const statusEl = document.getElementById("formStatus");
      const submitBtn = document.getElementById("submitBtn");
      const paymentMethod = document.getElementById("payment_method");
      const depositConfirm = document.getElementById("deposit_confirm");
      const depositBox = document.getElementById("depositBox");
      const baseRateDisplay = document.getElementById("baseRateDisplay");
      const totalRateDisplay = document.getElementById("totalRateDisplay");
      const pseAddonRow = document.getElementById("pseAddonRow");
      const pseAddonDisplay = document.getElementById("pseAddonDisplay");
      const depositRateDisplay = document.getElementById("depositRateDisplay");
      const totalRateNote = document.getElementById("totalRateNote");
      const depositRateNote = document.getElementById("depositRateNote");
      const tourCityEl = document.getElementById("tourCity");
      const tourTzEl = document.getElementById("tourTz");
      const successPopup = document.getElementById("successPopup");
      const successTitle = document.getElementById("successTitle");
      const successMessage = document.getElementById("successMessage");
      const successEmail = document.getElementById("successEmail");
      const successLink = document.getElementById("successLink");
      const successClose = document.getElementById("successClose");
      const alertPopup = document.getElementById("alertPopup");
      const alertPopupTitle = document.getElementById("alertPopupTitle");
      const alertPopupMessage = document.getElementById("alertPopupMessage");
      const alertPopupClose = document.getElementById("alertPopupClose");
      const emailInput = document.getElementById("email");
      const wizardTop = document.getElementById("wizardTop");
      const wizardCount = document.getElementById("wizardCount");
      const wizardTitle = document.getElementById("wizardTitle");
      const wizardStatus = document.getElementById("wizardStatus");
      const wizardFill = document.getElementById("wizardFill");
      const wizardNext = document.getElementById("wizardNext");
      const wizardBack = document.getElementById("wizardBack");
      const wizardNav = document.getElementById("wizardNav");
      const languageButtons = document.querySelectorAll(".age-language [data-language-choice]");
      const LANGUAGE_KEY = "hvh_inside_language";
      const SUPPORTED_LANGUAGES = ["en", "fr"];
      let currentLanguage = "en";
      const I18N = {
        en: {
          back_to_inside: "Back to inside",
          booking_title: "Van Booking Portal",
          booking_subtitle:
            "Simple, private scheduling. Send your request and I email the payment details. Your booking is confirmed after payment is processed.",
          wizard_step_label: "Booking step",
          wizard_count: "Step {current} of {total}",
          request_title: "Booking request",
          label_name: "Name",
          label_phone: "Phone number",
          phone_placeholder: "+ (country code) 555 1234",
          followup_phone_title: "Would you like me to contact you about my next trip to this city by phone?",
          followup_email_title: "Would you like me to contact you about my next trip to this city by email?",
          yes: "Yes",
          no: "No",
          other_cities: "Other cities?",
          followup_phone_placeholder: "Optional: Toronto, Vancouver, Paris",
          label_email: "Email",
          followup_email_placeholder: "Optional: Montreal, London, Berlin",
          label_notes: "Requests, info, tell me about you if you wish :)",
          notes_placeholder: "Optional. Share requests or any helpful info.",
          notes_hint: "Optional. Keep it respectful.",
          label_date: "Date of booking",
          touring_day_prefix: "On that day, Heidi will be in:",
          select_date: "Select a date",
          label_city: "City of booking",
          choose_option: "choose option",
          label_currency: "Currency",
          label_duration: "Duration",
          duration_hint: "Rates update with currency. Crypto shown in CAD.",
          discuss_whatsapp: "Discuss it with me on WhatsApp",
          label_service: "Service",
          label_location: "Location",
          incall: "Incall",
          outcall: "Outcall",
          outcall_hint: "Outcall requires an address so I can confirm travel time.",
          outcall_address: "Outcall address",
          availability_title: "Daily availability",
          availability_note_default: "Pick a date and duration to see available start times in order.",
          timezone_hint_prefix: "Times shown in this city timezone:",
          selected_time: "Selected time",
          payment_title: "Payment confirmation",
          base_rate: "Base rate:",
          pse_addon: "PSE add-on:",
          total_rate: "Total:",
          deposit_rate: "20% deposit:",
          deposit_note: "Deposit is 20% of total.",
          label_payment_method: "Payment method",
          etransfer_canada: "e-Transfer (Canada only)",
          deposit_consent: "I confirm the 20% deposit and payment method are correct.",
          crypto_hint: "Crypto amounts are shown as CAD reference.",
          request_booking: "Request booking",
          back: "Back",
          next: "Next",
          success_title: "Request received",
          pay_now: "Pay now",
          got_it: "Got it",
          alert_title: "Attention",
          alert_ok: "OK",
          booking_unavailable: "Booking is unavailable.",
          bad_vibe_alert: ":( bad vibe alert!",
          review_step: "Please review this step and try again.",
          payment_email_prefix: "Payment email:",
          select_duration: "Select duration",
          discuss_whatsapp_short: "Discuss on WhatsApp",
          custom_24h_note: "Custom 24+ hour bookings are confirmed after WhatsApp discussion.",
          custom_24h_validity: "Please discuss 24+ hour bookings on WhatsApp.",
          deposit_percent_note: "Deposit is {percent}% of total.",
          crypto_reference_note: "Crypto reference shown in CAD.",
          city_no_tour: "No touring in this city/date. Read touring dates carefully or arrange Fly me to you.",
          city_date_mismatch: "Heidi is in {city} on {date}. Read touring carefully or arrange Fly me to you.",
          availability_pick_date: "Pick a date to view availability.",
          city_tba: "TBA",
          availability_selected_date: "Availability shown for the selected date.",
          availability_need_standard:
            "Select a standard duration to view available times. 24+ hours is discussed on WhatsApp.",
          availability_read_touring: "Read touring dates carefully, or arrange Fly me to you.",
          availability_past_date: "This date is in the past. Pick a future date.",
          availability_none_left: "No start times left for this date and duration.",
          step_booking: "Booking",
          step_location_duration_service: "Location, duration and service",
          step_name_phone_email: "Name, phone and email",
          step_confirmation_payment: "Confirmation, bill and payment",
          step_city_date: "City and date",
          step_where_booking: "Where are you booking?",
          step_currency: "Which currency?",
          step_date: "What date do you want?",
          step_type: "Incall or outcall?",
          step_duration_service: "Duration and service",
          step_duration: "How long?",
          step_service: "Which service?",
          step_pick_time: "Pick an available time",
          step_name: "What name should I use?",
          step_contact: "Phone and email",
          step_phone: "What phone number can I reach?",
          step_email: "What email should receive payment details?",
          step_notes: "Requests, info, tell me about you if you wish :)",
          step_payment_method: "How will you send deposit?",
          step_deposit_confirm: "Confirm the deposit terms",
          step_submit: "Send your booking request",
          complete_step: "Please complete: {step}.",
          success_request_sent: "Request sent. Your reference: {id}. Check your email to proceed with payment.",
          send_error_prefix: "Couldn't send that.",
          duration_30m: "30 minutes",
          duration_1h: "1 hour",
          duration_1_5h: "1.5 hours",
          duration_2h: "2 hours",
          duration_3h: "3 hours",
          duration_4h: "4 hours",
          duration_social: "Social experiment (3 hours)",
          duration_8_12h: "8-12 hours",
          duration_24p: "24+ hours",
        },
        fr: {
          back_to_inside: "Retour a inside",
          booking_title: "Portail de reservation Van",
          booking_subtitle:
            "Reservation simple et privee. Envoyez votre demande et je vous envoie les details de paiement par email. La reservation est confirmee apres validation du paiement.",
          wizard_step_label: "Etape de reservation",
          wizard_count: "Etape {current} sur {total}",
          request_title: "Demande de reservation",
          label_name: "Nom",
          label_phone: "Numero de telephone",
          phone_placeholder: "+ (indicatif pays) 555 1234",
          followup_phone_title:
            "Souhaitez-vous que je vous contacte pour mon prochain passage dans cette ville par telephone?",
          followup_email_title:
            "Souhaitez-vous que je vous contacte pour mon prochain passage dans cette ville par email?",
          yes: "Oui",
          no: "Non",
          other_cities: "Autres villes?",
          followup_phone_placeholder: "Optionnel: Toronto, Vancouver, Paris",
          label_email: "Email",
          followup_email_placeholder: "Optionnel: Montreal, Londres, Berlin",
          label_notes: "Demandes, infos, parlez-moi de vous si vous voulez :)",
          notes_placeholder: "Optionnel. Partagez vos demandes ou infos utiles.",
          notes_hint: "Optionnel. Restez respectueux.",
          label_date: "Date de reservation",
          touring_day_prefix: "Ce jour-la, Heidi sera a:",
          select_date: "Choisissez une date",
          label_city: "Ville de reservation",
          choose_option: "choisir une option",
          label_currency: "Devise",
          label_duration: "Duree",
          duration_hint: "Les tarifs changent avec la devise. Crypto affichee en CAD.",
          discuss_whatsapp: "Discuter avec moi sur WhatsApp",
          label_service: "Service",
          label_location: "Lieu",
          incall: "Incall",
          outcall: "Outcall",
          outcall_hint: "Outcall demande une adresse pour confirmer le deplacement.",
          outcall_address: "Adresse outcall",
          availability_title: "Disponibilites du jour",
          availability_note_default: "Choisissez date et duree pour voir les heures disponibles dans l'ordre.",
          timezone_hint_prefix: "Heures affichees dans le fuseau de cette ville:",
          selected_time: "Heure choisie",
          payment_title: "Confirmation de paiement",
          base_rate: "Tarif de base:",
          pse_addon: "Supplement PSE:",
          total_rate: "Total:",
          deposit_rate: "Acompte 20%:",
          deposit_note: "L'acompte est de 20% du total.",
          label_payment_method: "Methode de paiement",
          etransfer_canada: "e-Transfer (Canada seulement)",
          deposit_consent: "Je confirme que l'acompte de 20% et la methode de paiement sont corrects.",
          crypto_hint: "Les montants crypto sont affiches en reference CAD.",
          request_booking: "Envoyer la demande",
          back: "Retour",
          next: "Suivant",
          success_title: "Demande recue",
          pay_now: "Payer maintenant",
          got_it: "Compris",
          alert_title: "Attention",
          alert_ok: "OK",
          booking_unavailable: "Reservation indisponible.",
          bad_vibe_alert: ":( alerte bad vibe!",
          review_step: "Verifiez cette etape puis recommencez.",
          payment_email_prefix: "Email paiement:",
          select_duration: "Choisissez la duree",
          discuss_whatsapp_short: "Discuter sur WhatsApp",
          custom_24h_note: "Les reservations 24h+ sont confirmees apres discussion WhatsApp.",
          custom_24h_validity: "Veuillez discuter des reservations 24h+ sur WhatsApp.",
          deposit_percent_note: "L'acompte est de {percent}% du total.",
          crypto_reference_note: "Reference crypto affichee en CAD.",
          city_no_tour: "Aucune tournee cette date dans cette ville. Lisez la tournee ou choisissez Fly me to you.",
          city_date_mismatch: "Heidi est a {city} le {date}. Lisez la tournee ou choisissez Fly me to you.",
          availability_pick_date: "Choisissez une date pour voir les disponibilites.",
          city_tba: "A definir",
          availability_selected_date: "Disponibilites pour la date choisie.",
          availability_need_standard:
            "Choisissez une duree standard pour voir les heures disponibles. Le 24h+ se discute sur WhatsApp.",
          availability_read_touring: "Lisez les dates de tournee, ou choisissez Fly me to you.",
          availability_past_date: "Cette date est passee. Choisissez une date future.",
          availability_none_left: "Aucune heure de depart restante pour cette date et duree.",
          step_booking: "Reservation",
          step_location_duration_service: "Lieu, duree et service",
          step_name_phone_email: "Nom, telephone et email",
          step_confirmation_payment: "Confirmation, facture et paiement",
          step_city_date: "Ville et date",
          step_where_booking: "Ou reservez-vous?",
          step_currency: "Quelle devise?",
          step_date: "Quelle date voulez-vous?",
          step_type: "Incall ou outcall?",
          step_duration_service: "Duree et service",
          step_duration: "Quelle duree?",
          step_service: "Quel service?",
          step_pick_time: "Choisissez une heure disponible",
          step_name: "Quel nom dois-je utiliser?",
          step_contact: "Telephone et email",
          step_phone: "Quel numero pour vous joindre?",
          step_email: "Quel email doit recevoir les details de paiement?",
          step_notes: "Demandes, infos, parlez-moi de vous si vous voulez :)",
          step_payment_method: "Comment enverrez-vous l'acompte?",
          step_deposit_confirm: "Confirmez les conditions d'acompte",
          step_submit: "Envoyer votre demande",
          complete_step: "Veuillez completer: {step}.",
          success_request_sent: "Demande envoyee. Votre reference: {id}. Verifiez votre email pour proceder au paiement.",
          send_error_prefix: "Impossible d'envoyer.",
          duration_30m: "30 minutes",
          duration_1h: "1 heure",
          duration_1_5h: "1,5 heure",
          duration_2h: "2 heures",
          duration_3h: "3 heures",
          duration_4h: "4 heures",
          duration_social: "Experience sociale (3 heures)",
          duration_8_12h: "8-12 heures",
          duration_24p: "24+ heures",
        },
      };
      const formatTemplate = (template, vars = {}) =>
        String(template || "").replace(/\{(\w+)\}/g, (_m, key) => (vars[key] ?? `{${key}}`));
      const t = (key, vars = {}) => {
        const pack = I18N[currentLanguage] || I18N.en;
        const fallback = I18N.en[key] || key;
        return formatTemplate(pack[key] || fallback, vars);
      };
      const getStoredLanguage = () => {
        try {
          const stored = window.localStorage.getItem(LANGUAGE_KEY);
          if (stored && SUPPORTED_LANGUAGES.includes(stored)) return stored;
        } catch (_error) {}
        return null;
      };
      const detectBrowserLanguage = () => {
        const langs = Array.isArray(navigator.languages) ? navigator.languages : [navigator.language || "en"];
        for (const lang of langs) {
          const short = String(lang || "").slice(0, 2).toLowerCase();
          if (SUPPORTED_LANGUAGES.includes(short)) return short;
        }
        return "en";
      };
      const CUSTOM_ALERT_SOUND = "/alert-badvibe.mp3";
      const FALLBACK_ALERT_SOUND = "/winxp-alert.mp3";
      const xpSound = new Audio(CUSTOM_ALERT_SOUND);
      xpSound.preload = "auto";
      xpSound.volume = 1;
      let alertSoundFallbackLoaded = false;
      xpSound.addEventListener(
        "error",
        () => {
          if (alertSoundFallbackLoaded) return;
          alertSoundFallbackLoaded = true;
          xpSound.src = FALLBACK_ALERT_SOUND;
          xpSound.load();
        },
        { once: true }
      );
      let bookingLocked = false;

      const PROFANITY_PATTERNS = [
        /\b(bitch|biatch|b!tch)\b/i,
        /\b(fuck|fuk|fck|f\*+k|motherf\w*)\b/i,
        /\b(slut|sl@t)\b/i,
        /\b(whore|hore)\b/i,
        /\b(cunt)\b/i,
        /\b(hoe|skank|thot)\b/i,
        /\b(stupid|idiot|dumb|moron|brainless|loser)\b/i,
        /\b(worthless|useless|trash|pathetic)\b/i,
        /\b(bimbo|dog|ugly)\b/i,
        /\b(salope|pute|putain|connard|connasse|encule|enculee|enfoire|merde)\b/i,
        /\b(puta|puto|cabron|pendejo|gilipollas|culero|pinche)\b/i,
        /\b(puttana|stronzo|stronza|bastardo)\b/i,
        /\b(vagabunda|otario|merda)\b/i,
        /\b(schlampe|fotze|arschloch|scheisse|dummkopf)\b/i,
        /\b(suka|blyat)\b/i,
      ];
      const setBookingLock = (message) => {
        bookingLocked = true;
        if (submitBtn) submitBtn.disabled = true;
        form.querySelectorAll("input, select, textarea, button").forEach((el) => {
          if (el.id === "successClose") return;
          el.disabled = true;
        });
        statusEl.textContent = message || t("booking_unavailable");
      };

      const checkBlacklist = async (email, phone) => {
        try {
          const response = await fetch("api/blacklist.php", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email, phone }),
          });
          const data = await response.json();
          return !!data.blocked;
        } catch (_error) {
          return false;
        }
      };

      const checkBlacklistOnLoad = async () => {
        try {
          const response = await fetch("api/blacklist.php", { cache: "no-store" });
          const data = await response.json();
          if (data && data.blocked) {
            setBookingLock(t("booking_unavailable"));
          }
        } catch (_error) {}
      };

      let tourCity = "Touring city not set";
      let tourTz = "America/Toronto";
      let bufferMinutes = 30;
      let selectedTourTimezone = tourTz;
      let selectedBufferMinutes = bufferMinutes;
      let availabilityMode = "open";
      let blockedSlots = [];
      let recurringBlocks = [];
      let citySchedules = [];
      let selectedSlotButton = null;
      let wizardStepIndex = 0;

        let tourSchedule = [
          { start: "2026-02-08", end: "2026-02-14", city: "Montreal" },
          { start: "2026-02-15", end: "2026-02-18", city: "Toronto" },
          { start: "2026-02-19", end: "2026-02-21", city: "Vancouver" },
          { start: "2026-02-22", end: "2026-03-04", city: "Montreal" },
          { start: "2026-03-05", end: "2026-03-09", city: "London (UK)" },
          { start: "2026-03-10", end: "2026-03-13", city: "Berlin" },
          { start: "2026-03-14", end: "2026-03-19", city: "Paris" },
        ];

      const monitoredFields = Array.from(
        form.querySelectorAll('input[type="text"], input[type="email"], input[type="tel"], textarea')
      );
      const BASE_CURRENCY = "CAD";
      const DEPOSIT_PERCENT = 20;
      const PSE_BILL_ADDON = 100;
      const FIAT_CURRENCIES = ["CAD", "USD", "EUR", "GBP"];
      const CRYPTO_CURRENCIES = ["USDC", "BTC", "LTC"];
      const FX_OVERRIDES = {
        EUR: 0.7,
        GBP: 0.65,
      };
      const RATE_API = `https://api.exchangerate.host/latest?base=${BASE_CURRENCY}&symbols=${FIAT_CURRENCIES.join(",")}`;
      const currencyCache = { rates: null };
      const RATE_BRACKETS = [0.5, 1, 1.5, 2, 3, 4, 12];
      const RATE_TABLE = {
        gfe: {
          0.5: 400,
          1: 700,
          1.5: 1000,
          2: 1300,
          3: 1600,
          4: 2000,
          12: 3000,
        },
        social: {
          3: 1000,
        },
      };
      const LONG_SESSION_MIN = 8;
      const LONG_SESSION_MAX = 12;
      const LONG_SESSION_RATE = 3000;
      const DURATION_OPTIONS = [
        { labelKey: "duration_30m", hours: 0.5, value: "0.5" },
        { labelKey: "duration_1h", hours: 1, value: "1" },
        { labelKey: "duration_1_5h", hours: 1.5, value: "1.5" },
        { labelKey: "duration_2h", hours: 2, value: "2" },
        { labelKey: "duration_3h", hours: 3, value: "3" },
        { labelKey: "duration_4h", hours: 4, value: "4" },
        { labelKey: "duration_social", hours: 3, value: "social", rateKey: "social" },
        { labelKey: "duration_8_12h", hours: 10, value: "8-12" },
        { labelKey: "duration_24p", hours: 0, value: "24+", custom: true },
      ];
      const getDurationLabel = (entry) => t(entry?.labelKey || "");

      const containsProfanity = (value) => PROFANITY_PATTERNS.some((pattern) => pattern.test(value));

      const playXpSound = () => {
        try {
          if (xpSound.src === "" || xpSound.src.endsWith("/")) {
            xpSound.src = FALLBACK_ALERT_SOUND;
          }
          xpSound.pause();
          xpSound.currentTime = 0;
          xpSound.play().catch(() => {
            try {
              if (xpSound.src.indexOf(FALLBACK_ALERT_SOUND) === -1) {
                xpSound.src = FALLBACK_ALERT_SOUND;
                xpSound.load();
                xpSound.play().catch(() => {});
              }
            } catch (_error) {}
          });
        } catch (_error) {}
      };

      const showBadVibe = (message = t("bad_vibe_alert")) => {
        const text = String(message || t("bad_vibe_alert"));
        statusEl.textContent = text;
        playXpSound();
        showAlertPopup(text);
      };

      const showWizardWarning = (message) => {
        const text = String(message || t("review_step"));
        if (wizardStatus) {
          wizardStatus.textContent = text;
        }
        showBadVibe(text);
      };

      const closeAlertPopup = () => {
        if (!alertPopup) return;
        alertPopup.classList.remove("show");
        alertPopup.setAttribute("aria-hidden", "true");
      };

      const showAlertPopup = (message) => {
        if (!alertPopup || !alertPopupMessage) return;
        alertPopupMessage.textContent = String(message || "");
        alertPopup.classList.add("show");
        alertPopup.setAttribute("aria-hidden", "false");
        const card = alertPopup.querySelector(".alert-popup-card");
        if (card) {
          card.classList.remove("shake");
          void card.offsetWidth;
          card.classList.add("shake");
        }
        if (alertPopupClose) {
          alertPopupClose.focus();
        }
      };

      const closeSuccessPopup = () => {
        if (!successPopup) return;
        successPopup.classList.remove("show");
        successPopup.setAttribute("aria-hidden", "true");
      };

      const showSuccessPopup = (message, link, emailValue) => {
        if (!successPopup || !successMessage) return;
        successMessage.textContent = message;
        if (successEmail) {
          if (emailValue) {
            successEmail.textContent = `${t("payment_email_prefix")} ${emailValue}`;
          } else {
            successEmail.textContent = "";
          }
        }
        successPopup.classList.add("show");
        successPopup.setAttribute("aria-hidden", "false");
        playXpSound();
        if (successLink) {
          if (link) {
            successLink.href = link;
            successLink.classList.remove("hidden");
          } else {
            successLink.classList.add("hidden");
          }
        }
        if (successClose) {
          successClose.focus();
        }
      };

      if (successClose) {
        successClose.addEventListener("click", closeSuccessPopup);
      }
      if (successPopup) {
        successPopup.addEventListener("click", (event) => {
          if (event.target === successPopup) {
            closeSuccessPopup();
          }
        });
      }
      if (alertPopupClose) {
        alertPopupClose.addEventListener("click", closeAlertPopup);
      }
      if (alertPopup) {
        alertPopup.addEventListener("click", (event) => {
          if (event.target === alertPopup) {
            closeAlertPopup();
          }
        });
      }
      document.addEventListener("keydown", (event) => {
        if (event.key !== "Escape") return;
        if (alertPopup && alertPopup.classList.contains("show")) {
          closeAlertPopup();
          return;
        }
        if (successPopup && successPopup.classList.contains("show")) {
          closeSuccessPopup();
        }
      });

      monitoredFields.forEach((field) => {
        field.dataset.cleanValue = field.value || "";
        field.addEventListener("input", () => {
          const currentValue = field.value;
          if (containsProfanity(currentValue)) {
            field.value = field.dataset.cleanValue || "";
            showBadVibe();
            field.blur();
            window.setTimeout(() => {
              try {
                field.focus({ preventScroll: false });
              } catch (_error) {
                field.focus();
              }
            }, 120);
            return;
          }
          field.dataset.cleanValue = currentValue;
        });
      });

      const detectDefaultCurrency = () => {
        try {
          const resolved = new Intl.NumberFormat().resolvedOptions().currency;
          if (FIAT_CURRENCIES.includes(resolved)) return resolved;
        } catch (_error) {
          return BASE_CURRENCY;
        }
        return BASE_CURRENCY;
      };

      const formatCurrency = (amount, currency) => {
        try {
          const decimals = currency === BASE_CURRENCY || currency === "USD" ? 0 : 2;
          return new Intl.NumberFormat(undefined, {
            style: "currency",
            currency,
            minimumFractionDigits: decimals,
            maximumFractionDigits: decimals,
          }).format(amount);
        } catch (_error) {
          return `${currency} ${amount.toFixed(2)}`;
        }
      };

      const normalizeExperience = (value) => (value === "gfe" ? "gfe" : "pse");

      const getBaseRate = (hours, experience, rateKey) => {
        if (!Number.isFinite(hours) || hours <= 0) return 0;
        if (rateKey === "social") {
          return RATE_TABLE.social[3];
        }
        if (hours >= LONG_SESSION_MIN && hours <= LONG_SESSION_MAX) {
          return LONG_SESSION_RATE;
        }
        const rates = RATE_TABLE.gfe;
        if (rates[hours]) return rates[hours];
        let lower = null;
        let upper = null;
        const sorted = RATE_BRACKETS.slice().sort((a, b) => a - b);
        for (const bracket of sorted) {
          if (bracket < hours) {
            lower = bracket;
            continue;
          }
          if (bracket > hours) {
            upper = bracket;
            break;
          }
        }
        if (lower === null) return rates[sorted[0]] || 0;
        if (upper === null) return rates[sorted[sorted.length - 1]] || 0;
        const lowerRate = rates[lower];
        const upperRate = rates[upper];
        const ratio = (hours - lower) / (upper - lower);
        return Math.round(lowerRate + (upperRate - lowerRate) * ratio);
      };

      const getFiatRates = async () => {
        if (currencyCache.rates) return currencyCache.rates;
        try {
          const response = await fetch(RATE_API);
          if (!response.ok) throw new Error("Rate fetch failed");
          const data = await response.json();
          if (!data || !data.rates) throw new Error("Rate data missing");
          currencyCache.rates = data.rates;
          return data.rates;
        } catch (_error) {
          return null;
        }
      };

      const formatRateLabel = async (amount, currency) => {
        if (!currency || currency === BASE_CURRENCY) {
          return formatCurrency(amount, BASE_CURRENCY);
        }
        if (currency === "USD") {
          return formatCurrency(amount, "USD");
        }
        if (CRYPTO_CURRENCIES.includes(currency)) {
          return `${formatCurrency(amount, BASE_CURRENCY)} CAD`;
        }
        const overrideRate = FX_OVERRIDES[currency];
        if (typeof overrideRate === "number") {
          return formatCurrency(amount * overrideRate, currency);
        }
        const rates = await getFiatRates();
        const rate = rates ? rates[currency] : null;
        if (!rate) {
          return formatCurrency(amount, BASE_CURRENCY);
        }
        return formatCurrency(amount * rate, currency);
      };

      const updatePaymentSummary = async () => {
        if (!baseRateDisplay || !totalRateDisplay || !depositRateDisplay) return;
        const selected = durationSelect.selectedOptions[0];
        if (!selected) {
          baseRateDisplay.textContent = t("select_duration");
          totalRateDisplay.textContent = t("select_duration");
          depositRateDisplay.textContent = "--";
          if (pseAddonRow) pseAddonRow.classList.add("hidden");
          if (pseAddonDisplay) pseAddonDisplay.textContent = "--";
          if (totalRateNote) totalRateNote.textContent = "";
          if (depositRateNote) depositRateNote.textContent = t("deposit_note");
          return;
        }
        const hours = Number(selected.dataset.hours || 0);
        const rateKey = selected.dataset.rateKey || "";
        const experience = experienceSelect.value || "gfe";
        const currency = currencySelect.value || BASE_CURRENCY;
        if (selected.dataset.custom === "true" || selected.value === "24+") {
          baseRateDisplay.textContent = t("discuss_whatsapp_short");
          totalRateDisplay.textContent = t("discuss_whatsapp_short");
          depositRateDisplay.textContent = "--";
          if (pseAddonRow) pseAddonRow.classList.add("hidden");
          if (pseAddonDisplay) pseAddonDisplay.textContent = "--";
          if (totalRateNote) totalRateNote.textContent = "";
          if (depositRateNote) {
            depositRateNote.textContent = t("custom_24h_note");
          }
          if (durationSelect) {
            durationSelect.setCustomValidity(t("custom_24h_validity"));
          }
          if (whatsappDiscuss) {
            whatsappDiscuss.hidden = false;
          }
          return;
        }
        if (durationSelect) {
          durationSelect.setCustomValidity("");
        }
        if (whatsappDiscuss) {
          whatsappDiscuss.hidden = true;
        }
        if (!Number.isFinite(hours) || hours <= 0) {
          baseRateDisplay.textContent = t("select_duration");
          totalRateDisplay.textContent = t("select_duration");
          depositRateDisplay.textContent = "--";
          if (pseAddonRow) pseAddonRow.classList.add("hidden");
          if (pseAddonDisplay) pseAddonDisplay.textContent = "--";
          if (totalRateNote) totalRateNote.textContent = "";
          if (depositRateNote) depositRateNote.textContent = t("deposit_percent_note", { percent: DEPOSIT_PERCENT });
          return;
        }
        const baseRate = getBaseRate(hours, experience, rateKey);
        const pseAddonBase = normalizeExperience(experience) === "pse" ? PSE_BILL_ADDON : 0;
        const totalBase = baseRate + pseAddonBase;
        const depositBase = Math.round(totalBase * (DEPOSIT_PERCENT / 100));
        const baseLabel = await formatRateLabel(baseRate, currency);
        const totalLabel = await formatRateLabel(totalBase, currency);
        const depositLabel = await formatRateLabel(depositBase, currency);
        baseRateDisplay.textContent = baseLabel;
        totalRateDisplay.textContent = totalLabel;
        depositRateDisplay.textContent = depositLabel;
        if (pseAddonRow && pseAddonDisplay) {
          if (pseAddonBase > 0) {
            const addonLabel = await formatRateLabel(pseAddonBase, currency);
            pseAddonDisplay.textContent = addonLabel;
            pseAddonRow.classList.remove("hidden");
          } else {
            pseAddonDisplay.textContent = "--";
            pseAddonRow.classList.add("hidden");
          }
        }
        if (totalRateNote) {
          totalRateNote.textContent = CRYPTO_CURRENCIES.includes(currency) ? t("crypto_reference_note") : "";
        }
        if (depositRateNote) {
          depositRateNote.textContent = t("deposit_percent_note", { percent: DEPOSIT_PERCENT });
        }
      };

      const updateDurationOptions = async () => {
        const currentCurrency = currencySelect.value || BASE_CURRENCY;
        const currentExperience = experienceSelect.value || "gfe";
        const previousValue = durationSelect.value;
        durationSelect.innerHTML = "";
        const placeholder = document.createElement("option");
        placeholder.value = "";
        placeholder.textContent = t("choose_option");
        placeholder.disabled = true;
        placeholder.selected = true;
        durationSelect.appendChild(placeholder);

        for (const entry of DURATION_OPTIONS) {
          const option = document.createElement("option");
          option.value = entry.value;
          option.dataset.hours = String(entry.hours);
          option.dataset.rateKey = entry.rateKey || "";
          option.dataset.label = getDurationLabel(entry);
          if (entry.custom) {
            option.dataset.custom = "true";
            option.textContent = `${getDurationLabel(entry)} - ${t("discuss_whatsapp_short")}`;
          } else {
            const baseRate = getBaseRate(entry.hours, currentExperience, entry.rateKey || "");
            const priceLabel = await formatRateLabel(baseRate, currentCurrency);
            option.textContent = `${getDurationLabel(entry)} - ${priceLabel}`;
          }
          durationSelect.appendChild(option);
        }

        if (
          previousValue &&
          Array.from(durationSelect.options).some((option) => option.value === previousValue)
        ) {
          durationSelect.value = previousValue;
        } else {
          durationSelect.value = "";
        }
        await updatePaymentSummary();
        renderDayCalendar();
      };

        const normalizeTourSchedule = (list) => {
          if (!Array.isArray(list)) return [];
          return list
            .map((entry) => ({
              start: String(entry?.start || "").trim(),
              end: String(entry?.end || "").trim(),
              city: sanitizeCityLabel(entry?.city),
            }))
            .filter(
              (entry) =>
                entry.start &&
                entry.end &&
                entry.city &&
                /^\d{4}-\d{2}-\d{2}$/.test(entry.start) &&
                /^\d{4}-\d{2}-\d{2}$/.test(entry.end) &&
                entry.start <= entry.end
            )
            .sort((a, b) => a.start.localeCompare(b.start));
        };

        const normalizeCityScheduleList = (list) => {
          if (!Array.isArray(list)) return [];
          return list
            .map((entry) => ({
              city: sanitizeCityLabel(entry?.city),
              start: String(entry?.start || "").trim(),
              end: String(entry?.end || "").trim(),
              timezone: String(entry?.timezone || "").trim(),
              buffer_minutes: Number(entry?.buffer_minutes || 0),
            }))
            .filter(
              (entry) =>
                entry.city &&
                entry.start &&
                entry.end &&
                /^\d{4}-\d{2}-\d{2}$/.test(entry.start) &&
                /^\d{4}-\d{2}-\d{2}$/.test(entry.end) &&
                entry.start <= entry.end
            )
            .sort((a, b) => a.start.localeCompare(b.start));
        };

        const getCityForDate = (dateKey) => {
          if (!dateKey) return "";
          const match = tourSchedule.find((entry) => dateKey >= entry.start && dateKey <= entry.end);
          return match ? match.city : "";
        };

      const sanitizeCityLabel = (value) => {
        const rawCity = String(value || "").trim();
        if (!rawCity) return "";
        const normalizedAlias = rawCity.toLowerCase().replace(/ß/g, "b").replace(/\s+/g, " ").trim();
        if (normalizedAlias === "b mode") return "Montreal";
        return rawCity;
      };

      const normalizeCityName = (value) =>
        String(value || "")
          .trim()
          .toLowerCase()
          .replace(/\s+/g, " ");

      const isFlyMeCity = (value) => normalizeCityName(value) === "fly me to you";

      const getFallbackTourCity = () => {
        const fallbackCity = sanitizeCityLabel(tourCity);
        if (!fallbackCity) return "";
        if (normalizeCityName(fallbackCity) === normalizeCityName("Touring city not set")) {
          return "";
        }
        return fallbackCity;
      };

      const defaultCityOptions = citySelect
        ? Array.from(citySelect.options)
            .map((option) => String(option.value || "").trim())
            .filter((value) => value && !isFlyMeCity(value))
        : [];

      const syncCityOptions = () => {
        if (!citySelect) return;
        const previousCity = citySelect.value;
        const placeholderText =
          citySelect.querySelector('option[value=""]')?.textContent || t("choose_option");
        const flyMeLabel = "Fly me to you";
        const cityPool = [
          ...defaultCityOptions,
          ...tourSchedule.map((entry) => sanitizeCityLabel(entry?.city)),
          ...citySchedules.map((entry) => sanitizeCityLabel(entry?.city)),
          getFallbackTourCity(),
        ];
        const seen = new Set();
        const uniqueCities = [];
        cityPool.forEach((city) => {
          const cityLabel = String(city || "").trim();
          const cityKey = normalizeCityName(cityLabel);
          if (!cityKey || seen.has(cityKey) || isFlyMeCity(cityLabel)) return;
          seen.add(cityKey);
          uniqueCities.push(cityLabel);
        });
        citySelect.innerHTML = "";
        const placeholderOption = document.createElement("option");
        placeholderOption.value = "";
        placeholderOption.disabled = true;
        placeholderOption.textContent = placeholderText;
        citySelect.appendChild(placeholderOption);
        uniqueCities.forEach((city) => {
          const option = document.createElement("option");
          option.value = city;
          option.textContent = city;
          citySelect.appendChild(option);
        });
        const flyMeOption = document.createElement("option");
        flyMeOption.value = flyMeLabel;
        flyMeOption.textContent = flyMeLabel;
        citySelect.appendChild(flyMeOption);

        const previousKey = normalizeCityName(previousCity);
        if (!previousKey) {
          citySelect.value = "";
          return;
        }
        const matchedOption = Array.from(citySelect.options).find(
          (option) => normalizeCityName(option.value) === previousKey
        );
        citySelect.value = matchedOption ? matchedOption.value : "";
      };

      const getCityScheduleForDate = (dateKey, selectedCity = "") => {
        if (!dateKey) return null;
        let targetCity = selectedCity;
        if (!targetCity || isFlyMeCity(targetCity)) {
          targetCity = getCityForDate(dateKey);
        }
        if (!targetCity) return null;
        const cityKey = normalizeCityName(targetCity);
        return (
          citySchedules.find(
            (entry) =>
              dateKey >= entry.start &&
              dateKey <= entry.end &&
              normalizeCityName(entry.city) === cityKey
          ) || null
        );
      };

      const updateSelectedTourContext = () => {
        const dateKey = preferredDate?.value || "";
        const cityValue = citySelect?.value || "";
        const schedule = getCityScheduleForDate(dateKey, cityValue);
        selectedTourTimezone = schedule?.timezone || tourTz;
        const scheduleBuffer = Number(schedule?.buffer_minutes);
        selectedBufferMinutes = Number.isFinite(scheduleBuffer) ? Math.max(0, scheduleBuffer) : bufferMinutes;
        if (tourTzEl) {
          tourTzEl.textContent = selectedTourTimezone;
        }
        const displayCity = schedule?.city || getCityForDate(dateKey) || getFallbackTourCity();
        if (tourCityEl) {
          tourCityEl.textContent = displayCity;
        }
        return schedule;
      };

      const getNowInTourTimezone = () => {
        try {
          updateSelectedTourContext();
          const parts = new Intl.DateTimeFormat("en-CA", {
            timeZone: selectedTourTimezone || tourTz,
            year: "numeric",
            month: "2-digit",
            day: "2-digit",
            hour: "2-digit",
            minute: "2-digit",
            hourCycle: "h23",
          }).formatToParts(new Date());
          const values = {};
          parts.forEach((part) => {
            if (part.type !== "literal") {
              values[part.type] = part.value;
            }
          });
          const dateKey = `${values.year}-${values.month}-${values.day}`;
          const minutes = Number(values.hour || 0) * 60 + Number(values.minute || 0);
          return { dateKey, minutes };
        } catch (_error) {
          const fallback = new Date();
          return {
            dateKey: fallback.toISOString().split("T")[0],
            minutes: fallback.getHours() * 60 + fallback.getMinutes(),
          };
        }
      };

      const setBookingDateFloor = () => {
        if (!preferredDate) return;
        const now = getNowInTourTimezone();
        preferredDate.min = now.dateKey;
      };

      const validateDateNotPast = () => {
        if (!preferredDate) return true;
        preferredDate.setCustomValidity("");
        if (!preferredDate.value) return true;
        const now = getNowInTourTimezone();
        if (preferredDate.value < now.dateKey) {
          preferredDate.setCustomValidity("Pick today or a future date.");
          return false;
        }
        return true;
      };

      const isSelectedDateTimeInPast = (dateKey, timeLabel) => {
        if (!dateKey || !timeLabel) return false;
        const minutes = timeToMinutes(timeLabel);
        if (minutes === null) return false;
        const now = getNowInTourTimezone();
        if (dateKey < now.dateKey) return true;
        if (dateKey > now.dateKey) return false;
        return minutes <= now.minutes;
      };

      const validateCityForDate = ({ showMessage = true } = {}) => {
        if (!citySelect || !preferredDate) return true;
        updateSelectedTourContext();
        citySelect.setCustomValidity("");
        if (cityMismatchWarning && showMessage) {
          cityMismatchWarning.classList.add("hidden");
        }
        return true;
      };

      const validateSelectedTimeNotPast = () => {
        if (!preferredDate || !preferredTime) return true;
        if (!preferredDate.value || !preferredTime.value) return true;
        if (isSelectedDateTimeInPast(preferredDate.value, preferredTime.value)) {
          preferredTime.setCustomValidity("Please pick a future time.");
          return false;
        }
        preferredTime.setCustomValidity("");
        return true;
      };

      const timeToMinutes = (timeValue) => {
        const [hour, minute] = String(timeValue || "").split(":").map((value) => Number(value));
        if (Number.isNaN(hour) || Number.isNaN(minute)) return null;
        return hour * 60 + minute;
      };

      const weekdayLabelToIndex = (label) => {
        const map = { Sun: 0, Mon: 1, Tue: 2, Wed: 3, Thu: 4, Fri: 5, Sat: 6 };
        return map[label] ?? 0;
      };

      const getWeekdayIndex = (dateKey) => {
        const [year, month, day] = String(dateKey).split("-").map((value) => Number(value));
        if (!year || !month || !day) return 0;
        const base = new Date(Date.UTC(year, month - 1, day, 12, 0));
        const label = new Intl.DateTimeFormat("en-US", {
          timeZone: selectedTourTimezone || tourTz,
          weekday: "short",
        }).format(base);
        return weekdayLabelToIndex(label);
      };

      const isRecurringBlocked = (dateKey, windowStart, windowEnd) => {
        if (!Array.isArray(recurringBlocks) || !recurringBlocks.length) return false;
        const weekdayIndex = getWeekdayIndex(dateKey);
        return recurringBlocks.some((block) => {
          if (!block) return false;
          const days = Array.isArray(block.days) ? block.days : [];
          if (!days.includes(weekdayIndex)) return false;
          if (block.all_day) return true;
          const startMinutes = timeToMinutes(block.start);
          const endMinutes = timeToMinutes(block.end);
          if (startMinutes === null || endMinutes === null) return false;
          return windowStart < endMinutes && windowEnd > startMinutes;
        });
      };

      const isSlotBlocked = (dateKey, startMinutes, endMinutes) => {
        if (availabilityMode === "closed") return true;
        if (!Array.isArray(blockedSlots) || !blockedSlots.length) {
          return isRecurringBlocked(dateKey, startMinutes, endMinutes);
        }
        const activeBuffer = Number.isFinite(selectedBufferMinutes) ? selectedBufferMinutes : bufferMinutes;
        const windowStart = Math.max(0, startMinutes - activeBuffer);
        const windowEnd = Math.min(1440, endMinutes + activeBuffer);
        if (isRecurringBlocked(dateKey, windowStart, windowEnd)) {
          return true;
        }
        return blockedSlots.some((entry) => {
          if (!entry || entry.date !== dateKey) return false;
          const blockStart = timeToMinutes(entry.start);
          const blockEnd = timeToMinutes(entry.end);
          if (blockStart === null || blockEnd === null) return false;
          return windowStart < blockEnd && windowEnd > blockStart;
        });
      };

      const clearSelectedSlot = () => {
        if (selectedSlotButton) {
          selectedSlotButton.classList.remove("selected");
          selectedSlotButton = null;
        }
        if (preferredTime) {
          preferredTime.value = "";
          preferredTime.setCustomValidity("");
        }
      };

      const getSelectedDurationMinutes = () => {
        const selected = durationSelect?.selectedOptions?.[0];
        if (!selected) return null;
        if (selected.dataset.custom === "true" || selected.value === "24+") {
          return null;
        }
        const hours = Number(selected.dataset.hours || 0);
        if (!Number.isFinite(hours) || hours <= 0) {
          return null;
        }
        return Math.max(30, Math.round(hours * 60));
      };

      const toTimeLabel = (minutes) => {
        const safe = Math.max(0, Math.min(1439, Number(minutes) || 0));
        const hour = String(Math.floor(safe / 60)).padStart(2, "0");
        const minute = String(safe % 60).padStart(2, "0");
        return `${hour}:${minute}`;
      };

      const renderDayCalendar = () => {
        if (!dayCalendar || !availabilitySummary || !preferredDate) return;
        const dateKey = preferredDate.value;
        if (!dateKey) {
          dayCalendar.innerHTML = "";
          dayCalendar.dataset.city = "";
          availabilitySummary.textContent = "";
          if (touringDayCityEl) touringDayCityEl.textContent = t("select_date");
          availabilityNote.textContent = t("availability_pick_date");
          clearSelectedSlot();
          return;
        }

        const cityContext = updateSelectedTourContext();
        const dayCity = cityContext?.city || getCityForDate(dateKey) || getFallbackTourCity();
        if (touringDayCityEl) touringDayCityEl.textContent = dayCity || t("city_tba");
        dayCalendar.dataset.city = dayCity || t("city_tba");
        availabilityNote.textContent = t("availability_selected_date");
        validateCityForDate({ showMessage: true });

        dayCalendar.innerHTML = "";
        clearSelectedSlot();
        const durationMinutes = getSelectedDurationMinutes();
        if (!durationMinutes) {
          const customMessage = document.createElement("p");
          customMessage.className = "day-empty";
          customMessage.textContent = t("availability_need_standard");
          dayCalendar.appendChild(customMessage);
          availabilitySummary.innerHTML = "";
          return;
        }

        if (!validateCityForDate({ showMessage: true })) {
          const cityMessage = document.createElement("p");
          cityMessage.className = "day-empty";
          cityMessage.textContent = t("availability_read_touring");
          dayCalendar.appendChild(cityMessage);
          availabilitySummary.innerHTML = "";
          return;
        }

        const now = getNowInTourTimezone();
        if (dateKey < now.dateKey) {
          const pastDateMessage = document.createElement("p");
          pastDateMessage.className = "day-empty";
          pastDateMessage.textContent = t("availability_past_date");
          dayCalendar.appendChild(pastDateMessage);
          availabilitySummary.innerHTML = "";
          return;
        }

        const slots = [];
        let blockedCount = 0;
        for (let startMinutes = 0; startMinutes + durationMinutes <= 1440; startMinutes += 30) {
          const endMinutes = startMinutes + durationMinutes;
          if (dateKey === now.dateKey && startMinutes <= now.minutes) {
            blockedCount += 1;
            continue;
          }
          const blocked = isSlotBlocked(dateKey, startMinutes, endMinutes);
          if (blocked) {
            blockedCount += 1;
            continue;
          }
          slots.push({
            startLabel: toTimeLabel(startMinutes),
            endLabel: toTimeLabel(endMinutes),
          });
        }

        if (!slots.length) {
          const emptyMessage = document.createElement("p");
          emptyMessage.className = "day-empty";
          emptyMessage.textContent = t("availability_none_left");
          dayCalendar.appendChild(emptyMessage);
        }

        slots.forEach((slot) => {
          const button = document.createElement("button");
          button.type = "button";
          button.className = "slot available";
          button.textContent = `${slot.startLabel} - ${slot.endLabel}`;
          button.addEventListener("click", () => {
            if (selectedSlotButton) {
              selectedSlotButton.classList.remove("selected");
            }
            selectedSlotButton = button;
            selectedSlotButton.classList.add("selected");
            if (preferredTime) {
              preferredTime.value = slot.startLabel;
              validateSelectedTimeNotPast();
            }
          });
          if (preferredTime && preferredTime.value && preferredTime.value === slot.startLabel) {
            selectedSlotButton = button;
            selectedSlotButton.classList.add("selected");
          }
          dayCalendar.appendChild(button);
        });

        availabilitySummary.innerHTML = "";
      };

      const loadTourSchedule = async () => {
        try {
          const response = await fetch("api/site-content.php", { cache: "no-store" });
          if (!response.ok) throw new Error("touring");
          const data = await response.json();
          const schedule = normalizeTourSchedule(data.touring || []);
          if (schedule.length) {
            tourSchedule = schedule;
          }
          syncCityOptions();
          validateCityForDate({ showMessage: true });
          renderDayCalendar();
        } catch (_error) {
        }
      };

      const toggleOutcall = () => {
        const selected = document.querySelector('input[name="booking_type"]:checked');
        const isOutcall = selected && selected.value === "outcall";
        if (outcallField) {
          outcallField.classList.toggle("hidden", !isOutcall);
        }
        if (outcallInput) {
          outcallInput.required = isOutcall;
          if (!isOutcall) outcallInput.value = "";
        }
      };

      const requestFields = Array.from(panelRequest?.querySelectorAll(".field") || []);
      const cityField = citySelect ? citySelect.closest(".field") : null;
      const dateField = preferredDate ? preferredDate.closest(".field") : null;
      const durationField = durationSelect ? durationSelect.closest(".field") : null;
      const experienceField = experienceSelect ? experienceSelect.closest(".field") : null;
      const currencyField = currencySelect ? currencySelect.closest(".field") : null;
      const nameField = nameInput ? nameInput.closest(".field") : null;
      const phoneField = phoneInput ? phoneInput.closest(".field") : null;
      const emailField = emailInput ? emailInput.closest(".field") : null;
      const notesField = notesInput ? notesInput.closest(".field") : null;
      const allPanels = [panelRequest, panelAvailability, panelPayment, panelSubmit].filter(Boolean);

      const wizardSteps = [
        {
          key: "booking",
          titleKey: "step_booking",
          panels: [panelRequest],
          requestFields: [cityField, dateField, currencyField],
          validate: () => {
            if (!(citySelect?.reportValidity() ?? true)) return false;
            setBookingDateFloor();
            validateDateNotPast();
            if (!(preferredDate?.reportValidity() ?? true)) return false;
            if (!(currencySelect?.reportValidity() ?? true)) return false;
            if (!validateCityForDate({ showMessage: true })) {
              citySelect?.reportValidity();
              return false;
            }
            return true;
          },
        },
        {
          key: "location-duration-service",
          titleKey: "step_location_duration_service",
          panels: [panelRequest, panelAvailability],
          requestFields: [bookingTypeField, outcallField, durationField, experienceField],
          validate: () => {
            toggleOutcall();
            const selected = document.querySelector('input[name="booking_type"]:checked');
            if (!selected) return false;
            if (outcallInput?.required && !(outcallInput?.reportValidity() ?? true)) {
              return false;
            }
            const okDuration = durationSelect?.reportValidity() ?? true;
            if (!okDuration) return false;
            const okService = experienceSelect?.reportValidity() ?? true;
            if (!okService) return false;
            if (!validateDateNotPast()) {
              preferredDate?.reportValidity();
              return false;
            }
            if (!(preferredTime?.reportValidity() ?? true)) {
              return false;
            }
            if (!validateSelectedTimeNotPast()) {
              preferredTime?.reportValidity();
              return false;
            }
            return true;
          },
        },
        {
          key: "identity",
          titleKey: "step_name_phone_email",
          panels: [panelRequest],
          requestFields: [nameField, phoneField, emailField],
          validate: () => {
            const okName = nameInput?.reportValidity() ?? true;
            if (!okName) return false;
            const okPhone = phoneInput?.reportValidity() ?? true;
            if (!okPhone) return false;
            const okEmail = emailInput?.reportValidity() ?? true;
            return okEmail;
          },
        },
        {
          key: "confirmation",
          titleKey: "step_confirmation_payment",
          panels: [panelPayment, panelSubmit],
          paymentMode: "all",
          validate: () => {
            const okMethod = paymentMethod?.reportValidity() ?? true;
            if (!okMethod) return false;
            return depositConfirm?.reportValidity() ?? true;
          },
        },
      ];

      const setPaymentStepMode = (mode) => {
        if (!panelPayment) return;
        if (depositBox) {
          depositBox.classList.remove("wizard-hidden");
        }
        if (mode === "method") {
          paymentGrid?.classList.remove("wizard-hidden");
          depositConsentRow?.classList.add("wizard-hidden");
          paymentCryptoHint?.classList.add("wizard-hidden");
          return;
        }
        if (mode === "confirm") {
          paymentGrid?.classList.add("wizard-hidden");
          depositConsentRow?.classList.remove("wizard-hidden");
          paymentCryptoHint?.classList.remove("wizard-hidden");
          return;
        }
        paymentGrid?.classList.remove("wizard-hidden");
        depositConsentRow?.classList.remove("wizard-hidden");
        paymentCryptoHint?.classList.remove("wizard-hidden");
      };

      const renderWizardStep = (index) => {
        if (!wizardSteps.length) return;
        const safeIndex = Math.max(0, Math.min(wizardSteps.length - 1, index));
        wizardStepIndex = safeIndex;
        const step = wizardSteps[wizardStepIndex];
        const total = wizardSteps.length;
        const visiblePanels = Array.isArray(step.panels) && step.panels.length ? step.panels : [step.panel].filter(Boolean);

        allPanels.forEach((panel) => panel.classList.add("wizard-hidden"));
        visiblePanels.forEach((panel) => panel?.classList.remove("wizard-hidden"));

        requestFields.forEach((field) => field.classList.add("wizard-hidden"));
        if (step.requestFields?.length) {
          step.requestFields.forEach((field) => field?.classList.remove("wizard-hidden"));
        }
        if (step.requestFields?.includes(bookingTypeField)) {
          toggleOutcall();
        }

        if (visiblePanels.includes(panelPayment)) {
          setPaymentStepMode(step.paymentMode || "all");
        } else {
          setPaymentStepMode("all");
        }

        if (wizardCount) {
          wizardCount.textContent = t("wizard_count", { current: wizardStepIndex + 1, total });
        }
        if (wizardTitle) {
          wizardTitle.textContent = t(step.titleKey || "wizard_step_label");
        }
        if (wizardFill) {
          wizardFill.style.width = `${Math.round(((wizardStepIndex + 1) / total) * 100)}%`;
        }
        if (wizardBack) {
          wizardBack.disabled = wizardStepIndex === 0;
        }
        if (wizardNext) {
          wizardNext.classList.toggle("wizard-hidden", wizardStepIndex === total - 1);
        }
        if (wizardNav) {
          wizardNav.classList.remove("wizard-hidden");
        }
        if (wizardTop) {
          wizardTop.classList.remove("wizard-hidden");
        }

        if (visiblePanels.includes(panelAvailability)) {
          renderDayCalendar();
        }
      };

      const validateCurrentWizardStep = () => {
        const step = wizardSteps[wizardStepIndex];
        if (!step || typeof step.validate !== "function") return true;
        return !!step.validate();
      };

      const getCurrentWizardWarningMessage = () => {
        const step = wizardSteps[wizardStepIndex];
        if (!step) {
          return t("review_step");
        }
        const controls = [
          citySelect,
          preferredDate,
          durationSelect,
          preferredTime,
          paymentMethod,
          depositConfirm,
          nameInput,
          phoneInput,
          emailInput,
          notesInput,
          outcallInput,
        ];
        for (const control of controls) {
          if (!control) continue;
          if (!control.checkValidity()) {
            return control.validationMessage || t("complete_step", { step: t(step.titleKey || "wizard_step_label") });
          }
        }
        return t("complete_step", { step: t(step.titleKey || "wizard_step_label") });
      };

      const nextWizardStep = () => {
        if (!validateCurrentWizardStep()) {
          showWizardWarning(getCurrentWizardWarningMessage());
          return;
        }
        renderWizardStep(wizardStepIndex + 1);
        window.scrollTo({ top: 0, behavior: "smooth" });
      };

      const prevWizardStep = () => {
        renderWizardStep(wizardStepIndex - 1);
        window.scrollTo({ top: 0, behavior: "smooth" });
      };

      const loadAvailability = async () => {
        try {
          const response = await fetch("api/availability.php");
          if (!response.ok) {
            throw new Error("Availability not available");
          }
          const data = await response.json();
          tourCity = sanitizeCityLabel(data.tour_city || tourCity);
          tourTz = data.tour_timezone || tourTz;
          bufferMinutes = Number(data.buffer_minutes) || bufferMinutes;
          selectedTourTimezone = tourTz;
          selectedBufferMinutes = bufferMinutes;
          availabilityMode = data.availability_mode || availabilityMode;
          blockedSlots = Array.isArray(data.blocked) ? data.blocked : [];
          recurringBlocks = Array.isArray(data.recurring) ? data.recurring : [];
          citySchedules = normalizeCityScheduleList(data.city_schedules || []);
          syncCityOptions();
          updateSelectedTourContext();
          setBookingDateFloor();
          validateDateNotPast();
          validateCityForDate({ showMessage: true });
          renderDayCalendar();
        } catch (_error) {
          if (tourCityEl) tourCityEl.textContent = tourCity;
          if (tourTzEl) tourTzEl.textContent = selectedTourTimezone || tourTz;
        }
      };

      form.addEventListener("change", (event) => {
        if (event.target.name === "booking_type") {
          toggleOutcall();
        }
        if (event.target.id === "city") {
          validateCityForDate({ showMessage: true });
          renderDayCalendar();
        }
        if (event.target.id === "preferred_date") {
          validateDateNotPast();
          validateCityForDate({ showMessage: true });
          renderDayCalendar();
        }
        if (event.target.id === "currency" || event.target.id === "experience") {
          updateDurationOptions();
        }
        if (event.target.id === "duration") {
          updatePaymentSummary();
          renderDayCalendar();
        }
      });

      if (wizardNext) {
        wizardNext.addEventListener("click", nextWizardStep);
      }
      if (wizardBack) {
        wizardBack.addEventListener("click", prevWizardStep);
      }

      form.addEventListener("submit", async (event) => {
        event.preventDefault();
        statusEl.textContent = "";

        const lastStepIndex = wizardSteps.length - 1;
        if (wizardStepIndex !== lastStepIndex) {
          nextWizardStep();
          return;
        }

        if (bookingLocked) {
          statusEl.textContent = t("booking_unavailable");
          return;
        }

        if (!validateDateNotPast()) {
          preferredDate.reportValidity();
          return;
        }
        if (!validateCityForDate({ showMessage: true })) {
          citySelect.reportValidity();
          return;
        }
        if (!validateSelectedTimeNotPast()) {
          preferredTime.reportValidity();
          return;
        }

        if (!form.reportValidity()) {
          return;
        }

        const flaggedField = monitoredFields.find((field) => containsProfanity(field.value || ""));
        if (flaggedField) {
          showBadVibe();
          flaggedField.focus();
          return;
        }

        const emailValue = emailInput ? emailInput.value.trim() : "";
        const phoneValue = form.querySelector("#phone")?.value?.trim() || "";
        if (await checkBlacklist(emailValue, phoneValue)) {
          setBookingLock(t("booking_unavailable"));
          return;
        }

        const formData = new FormData(form);
        const selected = durationSelect.selectedOptions[0];
        const activeSchedule = updateSelectedTourContext();
        const payload = Object.fromEntries(formData.entries());
        payload.duration_label = selected?.dataset.label || "";
        payload.duration_hours = selected?.dataset.hours || "0";
        payload.duration_rate_key = selected?.dataset.rateKey || "";
        payload.currency = currencySelect.value || "";
        payload.deposit_percent = String(DEPOSIT_PERCENT);
        payload.deposit_confirm = formData.get("deposit_confirm") ? "1" : "";
        payload.tour_timezone = selectedTourTimezone || tourTz;
        payload.tour_city = activeSchedule?.city || getCityForDate(preferredDate.value) || getFallbackTourCity();
        payload.buffer_minutes = String(Number.isFinite(selectedBufferMinutes) ? selectedBufferMinutes : bufferMinutes);
        payload.preferred_time = preferredTime.value || "";

        const parseServerJson = (rawText) => {
          if (!rawText) return null;
          try {
            return JSON.parse(rawText);
          } catch (_error) {
            const start = rawText.indexOf("{");
            const end = rawText.lastIndexOf("}");
            if (start !== -1 && end > start) {
              try {
                return JSON.parse(rawText.slice(start, end + 1));
              } catch (_innerError) {
                return null;
              }
            }
            return null;
          }
        };

        try {
          const response = await fetch("api/request.php", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(payload),
          });
          const raw = await response.text();
          const result = parseServerJson(raw) || {};
          if (!response.ok) {
            const fieldError = result?.fields ? Object.values(result.fields)[0] : "";
            throw new Error(result.error || fieldError || `Server error (${response.status}).`);
          }
          const successText = t("success_request_sent", { id: result.id });
          statusEl.textContent = successText;
          const fallbackPayLink = result.id ? `/booking/pay/index.php?id=${encodeURIComponent(result.id)}` : "";
          const paymentLink =
            result.payment_page || (result.payment_link_is_url ? result.payment_link : "") || fallbackPayLink;
          const emailValue = emailInput ? emailInput.value.trim() : "";
          showSuccessPopup(successText, paymentLink, emailValue);
          form.reset();
          currencySelect.value = detectDefaultCurrency();
          await updateDurationOptions();
          toggleOutcall();
          setBookingDateFloor();
          validateCityForDate({ showMessage: true });
          renderDayCalendar();
          updatePaymentSummary();
          renderWizardStep(0);
        } catch (error) {
          statusEl.textContent = `${t("send_error_prefix")} ${error.message}`;
        }
      });

      const setLabelText = (fieldId, text) => {
        const label = document.querySelector(`label[for="${fieldId}"]`);
        if (label) label.textContent = text;
      };
      const setRadioLabelText = (name, value, text) => {
        const input = document.querySelector(`input[name="${name}"][value="${value}"]`);
        const span = input?.closest("label")?.querySelector("span");
        if (span) span.textContent = text;
      };
      const setOptionText = (selectId, value, text) => {
        const option = document.querySelector(`#${selectId} option[value="${value}"]`);
        if (option) option.textContent = text;
      };
      const setDepositRowPrefix = (selector, labelText) => {
        const row = document.querySelector(selector);
        if (!row) return;
        const firstNode = Array.from(row.childNodes).find((node) => node.nodeType === Node.TEXT_NODE);
        if (firstNode) {
          firstNode.nodeValue = `${labelText} `;
        }
      };
      const applyLanguage = async (lang, persist = true) => {
        currentLanguage = SUPPORTED_LANGUAGES.includes(lang) ? lang : "en";
        document.documentElement.setAttribute("lang", currentLanguage);
        if (persist) {
          try {
            window.localStorage.setItem(LANGUAGE_KEY, currentLanguage);
          } catch (_error) {}
        }

        document.title = t("booking_title");
        const backInsideLink = document.getElementById("backInsideLink");
        if (backInsideLink) backInsideLink.textContent = t("back_to_inside");
        const bookingTitle = document.getElementById("bookingTitle");
        if (bookingTitle) bookingTitle.textContent = t("booking_title");
        const bookingSubtitle = document.getElementById("bookingSubtitle");
        if (bookingSubtitle) bookingSubtitle.textContent = t("booking_subtitle");
        const panelRequestTitle = document.getElementById("panelRequestTitle");
        if (panelRequestTitle) panelRequestTitle.textContent = t("request_title");
        const panelAvailabilityTitle = document.getElementById("panelAvailabilityTitle");
        if (panelAvailabilityTitle) panelAvailabilityTitle.textContent = t("availability_title");
        const panelPaymentTitle = document.getElementById("panelPaymentTitle");
        if (panelPaymentTitle) panelPaymentTitle.textContent = t("payment_title");
        if (wizardTitle) wizardTitle.textContent = t("wizard_step_label");

        setLabelText("name", t("label_name"));
        setLabelText("phone", t("label_phone"));
        setLabelText("email", t("label_email"));
        setLabelText("notes", t("label_notes"));
        setLabelText("preferred_date", t("label_date"));
        setLabelText("city", t("label_city"));
        setLabelText("currency", t("label_currency"));
        setLabelText("duration", t("label_duration"));
        setLabelText("experience", t("label_service"));
        setLabelText("outcall_address", t("outcall_address"));
        setLabelText("preferred_time", t("selected_time"));
        setLabelText("payment_method", t("label_payment_method"));

        if (phoneInput) phoneInput.placeholder = t("phone_placeholder");
        const followupPhoneTitle = document.getElementById("followupPhoneTitle");
        if (followupPhoneTitle) followupPhoneTitle.textContent = t("followup_phone_title");
        const followupEmailTitle = document.getElementById("followupEmailTitle");
        if (followupEmailTitle) followupEmailTitle.textContent = t("followup_email_title");
        const followupPhoneCitiesLabel = document.getElementById("followupPhoneCitiesLabel");
        if (followupPhoneCitiesLabel) followupPhoneCitiesLabel.textContent = t("other_cities");
        const followupEmailCitiesLabel = document.getElementById("followupEmailCitiesLabel");
        if (followupEmailCitiesLabel) followupEmailCitiesLabel.textContent = t("other_cities");
        const followupPhoneCities = document.getElementById("followup_phone_other_cities");
        if (followupPhoneCities) followupPhoneCities.placeholder = t("followup_phone_placeholder");
        const followupEmailCities = document.getElementById("followup_email_other_cities");
        if (followupEmailCities) followupEmailCities.placeholder = t("followup_email_placeholder");
        if (notesInput) notesInput.placeholder = t("notes_placeholder");
        const notesHint = document.querySelector("#notesField .hint");
        if (notesHint) notesHint.textContent = t("notes_hint");

        setRadioLabelText("contact_followup_phone", "yes", t("yes"));
        setRadioLabelText("contact_followup_phone", "no", t("no"));
        setRadioLabelText("contact_followup_email", "yes", t("yes"));
        setRadioLabelText("contact_followup_email", "no", t("no"));
        setRadioLabelText("booking_type", "incall", t("incall"));
        setRadioLabelText("booking_type", "outcall", t("outcall"));

        const bookingLocationLabel = document.querySelector("#bookingTypeField > label:not(.radio-card)");
        if (bookingLocationLabel) bookingLocationLabel.textContent = t("label_location");
        const outcallHint = document.querySelector("#bookingTypeField .hint");
        if (outcallHint) outcallHint.textContent = t("outcall_hint");

        const touringDayNote = document.getElementById("touringDayNote");
        if (touringDayNote && touringDayNote.childNodes.length) {
          touringDayNote.childNodes[0].nodeValue = `${t("touring_day_prefix")} `;
        }
        if (touringDayCityEl && !preferredDate?.value) {
          touringDayCityEl.textContent = t("select_date");
        }
        if (cityMismatchWarning && cityMismatchWarning.classList.contains("hidden")) {
          cityMismatchWarning.textContent = t("city_no_tour");
        }

        const timezoneHintLine = document.getElementById("timezoneHintLine");
        if (timezoneHintLine && timezoneHintLine.childNodes.length) {
          timezoneHintLine.childNodes[0].nodeValue = `${t("timezone_hint_prefix")} `;
        }
        if (availabilityNote) availabilityNote.textContent = t("availability_note_default");
        if (durationHint) durationHint.textContent = t("duration_hint");
        if (whatsappDiscuss) {
          whatsappDiscuss.textContent = t("discuss_whatsapp");
          whatsappDiscuss.setAttribute("aria-label", t("discuss_whatsapp"));
        }

        setOptionText("city", "", t("choose_option"));
        syncCityOptions();
        setOptionText("currency", "", t("choose_option"));
        setOptionText("experience", "", t("choose_option"));
        setOptionText("payment_method", "", t("choose_option"));
        setOptionText("payment_method", "interac", t("etransfer_canada"));

        setDepositRowPrefix("#depositBox .deposit-total:nth-of-type(1)", t("base_rate"));
        setDepositRowPrefix("#pseAddonRow", t("pse_addon"));
        setDepositRowPrefix("#depositBox .deposit-total:nth-of-type(3)", t("total_rate"));
        setDepositRowPrefix("#depositBox .deposit-total:nth-of-type(4)", t("deposit_rate"));
        const depositConsentText = document.getElementById("depositConsentText");
        if (depositConsentText) depositConsentText.textContent = t("deposit_consent");
        if (paymentCryptoHint) paymentCryptoHint.textContent = t("crypto_hint");
        if (submitBtn) submitBtn.textContent = t("request_booking");
        if (wizardBack) wizardBack.textContent = t("back");
        if (wizardNext) wizardNext.textContent = t("next");
        if (successTitle) successTitle.textContent = t("success_title");
        if (successLink) successLink.textContent = t("pay_now");
        if (successClose) successClose.textContent = t("got_it");
        if (alertPopupTitle) alertPopupTitle.textContent = t("alert_title");
        if (alertPopupClose) alertPopupClose.textContent = t("alert_ok");
        if (depositRateNote) depositRateNote.textContent = t("deposit_note");

        languageButtons.forEach((button) => {
          button.setAttribute("aria-pressed", button.dataset.languageChoice === currentLanguage ? "true" : "false");
        });

        await updateDurationOptions();
        await updatePaymentSummary();
        renderWizardStep(wizardStepIndex);
        renderDayCalendar();
      };

      languageButtons.forEach((button) => {
        button.addEventListener("click", () => {
          applyLanguage(button.dataset.languageChoice, true);
        });
      });

      currencySelect.value = detectDefaultCurrency();
      syncCityOptions();
      setBookingDateFloor();
      updateDurationOptions();
      toggleOutcall();
      validateCityForDate({ showMessage: true });
      renderDayCalendar();
      renderWizardStep(0);
      loadTourSchedule();
      loadAvailability();
      checkBlacklistOnLoad();
      const initialLanguage = getStoredLanguage() || detectBrowserLanguage();
      applyLanguage(initialLanguage, true);
    </script>
  </body>
</html>


